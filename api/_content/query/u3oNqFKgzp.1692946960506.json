{"_path":"/blog/vuejs/vue","_dir":"vuejs","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Vue 解决编程式导航多次携带相同参数跳转同一页面报错问题","description":"Vue 解决编程式导航多次携带相同参数跳转同一页面报错问题。","slug":"solve-vue-route-same-path-with-params-problem","category":"vuejs","createtime":"2023-08-23 10:43","cover":"/images/content/cover/vue.png","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"vue-解决编程式导航多次携带相同参数跳转同一页面报错问题"},"children":[{"type":"text","value":"Vue 解决编程式导航多次携带相同参数跳转同一页面报错问题"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在 Vue2 中，通过编程式导航多次携带相同的参数跳转到同一页面，会报如下错误"}]},{"type":"element","tag":"code","props":{"className":["language-shell"],"code":"Uncaught (in promise) NavigationDuplicated: Avoided redundant navigation to current location: \"/search/asd?k=ASD\".\n","language":"shell","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-118306"},"children":[{"type":"text","value":"Uncaught"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":" (in "}]},{"type":"element","tag":"span","props":{"class":"ct-088893"},"children":[{"type":"text","value":"promise"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":") NavigationDuplicated: Avoided redundant navigation to current location: "}]},{"type":"element","tag":"span","props":{"class":"ct-088893"},"children":[{"type":"text","value":"\"/search/asd?k=ASD\""}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"."}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这是因为 vue-router 的 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"push"}]},{"type":"text","value":" 方法和 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"replace"}]},{"type":"text","value":" 方法会返回 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"promise"}]},{"type":"text","value":" ，需要对 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"promise"}]},{"type":"text","value":" 进行处理，之所以声明式导航跳转方式不会出现此类问题是因为 vue-router 底层已经处理好了，对于编程式导航，我们需要手动处理一下。"}]},{"type":"element","tag":"h2","props":{"id":"方式一"},"children":[{"type":"text","value":"方式一"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在调用 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"push"}]},{"type":"text","value":" 或 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"replace"}]},{"type":"text","value":" 进行路由跳转时，添加处理 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"promise"}]},{"type":"text","value":" 返回值的函数。"}]},{"type":"element","tag":"code","props":{"className":["language-javascript"],"code":"this.$router.push({name:\"search\",params:{keyword:this.keyword},query:{k:this.keyword,toUpperCase()}},()=>{},()=>{})\n","language":"javascript","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-572354"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":".$router."}]},{"type":"element","tag":"span","props":{"class":"ct-118306"},"children":[{"type":"text","value":"push"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"({name:"}]},{"type":"element","tag":"span","props":{"class":"ct-088893"},"children":[{"type":"text","value":"\"search\""}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":",params:{keyword:"}]},{"type":"element","tag":"span","props":{"class":"ct-572354"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":".keyword},query:{k:"}]},{"type":"element","tag":"span","props":{"class":"ct-572354"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":".keyword,"}]},{"type":"element","tag":"span","props":{"class":"ct-118306"},"children":[{"type":"text","value":"toUpperCase"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"()}},()"}]},{"type":"element","tag":"span","props":{"class":"ct-391872"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"{},()"}]},{"type":"element","tag":"span","props":{"class":"ct-391872"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"{})"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"方式二"},"children":[{"type":"text","value":"方式二"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"方式一需要在每次通过编程式导航进行路由跳转时通过手动传入 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"promise"}]},{"type":"text","value":" 处理函数，我们可以在路由的配置文件中，对 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"push"}]},{"type":"text","value":" 和 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"replace"}]},{"type":"text","value":" 方法进行重写，达到一劳永逸的目的。"}]},{"type":"element","tag":"code","props":{"className":["language-javascript"],"code":"// 重写 push 方法\nlet originPush = VueRouter.prototype.push; // 保存 VueRouter 原型对象上的 push 方法\nVueRouter.prototype.push = function (location, resolve, reject) {\n  if (resolve && reject) {\n    originPush.call(this, location, resolve, reject);\n  } else {\n    originPush.call(\n      this,\n      location,\n      () => {},\n      () => {}\n    );\n  }\n};\n// 重写 replace 方法\nlet originReplace = VueRouter.prototype.replace; // 保存 VueRouter 原型对象上的 replace 方法\nVueRouter.prototype.replace = function (location, resolve, reject) {\n  if (resolve && reject) {\n    originReplace.call(this, resolve, reject);\n  } else {\n    originReplace.call(\n      this,\n      () => {},\n      () => {}\n    );\n  }\n};\n","language":"javascript","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-080019"},"children":[{"type":"text","value":"// 重写 push 方法\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-391872"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":" originPush "}]},{"type":"element","tag":"span","props":{"class":"ct-257789"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-667354"},"children":[{"type":"text","value":"VueRouter"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-900255"},"children":[{"type":"text","value":"prototype"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":".push; "}]},{"type":"element","tag":"span","props":{"class":"ct-080019"},"children":[{"type":"text","value":"// 保存 VueRouter 原型对象上的 push 方法\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-667354"},"children":[{"type":"text","value":"VueRouter"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-900255"},"children":[{"type":"text","value":"prototype"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-118306"},"children":[{"type":"text","value":"push"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-257789"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-391872"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-818538"},"children":[{"type":"text","value":"location"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-818538"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-818538"},"children":[{"type":"text","value":"reject"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-257789"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":" (resolve "}]},{"type":"element","tag":"span","props":{"class":"ct-257789"},"children":[{"type":"text","value":"&&"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":" reject) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"    originPush."}]},{"type":"element","tag":"span","props":{"class":"ct-118306"},"children":[{"type":"text","value":"call"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-572354"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":", location, resolve, reject);\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"  } "}]},{"type":"element","tag":"span","props":{"class":"ct-257789"},"children":[{"type":"text","value":"else"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"    originPush."}]},{"type":"element","tag":"span","props":{"class":"ct-118306"},"children":[{"type":"text","value":"call"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"(\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-572354"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"      location,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"      () "}]},{"type":"element","tag":"span","props":{"class":"ct-391872"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":" {},\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"      () "}]},{"type":"element","tag":"span","props":{"class":"ct-391872"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":" {}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"    );\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"};\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-080019"},"children":[{"type":"text","value":"// 重写 replace 方法\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-391872"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":" originReplace "}]},{"type":"element","tag":"span","props":{"class":"ct-257789"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-667354"},"children":[{"type":"text","value":"VueRouter"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-900255"},"children":[{"type":"text","value":"prototype"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":".replace; "}]},{"type":"element","tag":"span","props":{"class":"ct-080019"},"children":[{"type":"text","value":"// 保存 VueRouter 原型对象上的 replace 方法\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-667354"},"children":[{"type":"text","value":"VueRouter"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-900255"},"children":[{"type":"text","value":"prototype"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-118306"},"children":[{"type":"text","value":"replace"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-257789"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-391872"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-818538"},"children":[{"type":"text","value":"location"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-818538"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-818538"},"children":[{"type":"text","value":"reject"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-257789"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":" (resolve "}]},{"type":"element","tag":"span","props":{"class":"ct-257789"},"children":[{"type":"text","value":"&&"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":" reject) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"    originReplace."}]},{"type":"element","tag":"span","props":{"class":"ct-118306"},"children":[{"type":"text","value":"call"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-572354"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":", resolve, reject);\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"  } "}]},{"type":"element","tag":"span","props":{"class":"ct-257789"},"children":[{"type":"text","value":"else"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"    originReplace."}]},{"type":"element","tag":"span","props":{"class":"ct-118306"},"children":[{"type":"text","value":"call"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"(\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-572354"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"      () "}]},{"type":"element","tag":"span","props":{"class":"ct-391872"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":" {},\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"      () "}]},{"type":"element","tag":"span","props":{"class":"ct-391872"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":" {}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"    );\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"class":"ct-248813"},"children":[{"type":"text","value":"};"}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-118306{color:#6F42C1;}\n.dark .ct-118306{color:#B392F0;}\n.sepia .ct-118306{color:#A6E22E;}\n.ct-248813{color:#24292E;}\n.dark .ct-248813{color:#E1E4E8;}\n.sepia .ct-248813{color:#F8F8F2;}\n.ct-088893{color:#032F62;}\n.dark .ct-088893{color:#9ECBFF;}\n.sepia .ct-088893{color:#E6DB74;}\n.ct-572354{color:#005CC5;}\n.dark .ct-572354{color:#79B8FF;}\n.sepia .ct-572354{color:#FD971F;}\n.ct-391872{color:#D73A49;}\n.dark .ct-391872{color:#F97583;}\n.sepia .ct-391872{color:#66D9EF;font-style:italic;}\n.ct-080019{color:#6A737D;}\n.sepia .ct-080019{color:#88846F;}\n.ct-257789{color:#D73A49;}\n.dark .ct-257789{color:#F97583;}\n.sepia .ct-257789{color:#F92672;}\n.ct-667354{color:#005CC5;}\n.dark .ct-667354{color:#79B8FF;}\n.sepia .ct-667354{color:#66D9EF;font-style:italic;}\n.ct-900255{color:#005CC5;}\n.dark .ct-900255{color:#79B8FF;}\n.sepia .ct-900255{color:#F8F8F2;}\n.ct-818538{color:#E36209;}\n.dark .ct-818538{color:#FFAB70;}\n.sepia .ct-818538{color:#FD971F;font-style:italic;}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"方式一","depth":2,"text":"方式一"},{"id":"方式二","depth":2,"text":"方式二"}]}},"_type":"markdown","_id":"content:blog:vuejs:Vue 解决编程式导航多次携带相同参数跳转同一页面报错问题.md","_source":"content","_file":"blog/vuejs/Vue 解决编程式导航多次携带相同参数跳转同一页面报错问题.md","_extension":"md"}